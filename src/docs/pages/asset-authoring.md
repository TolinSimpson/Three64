# Asset Authoring (Blender)

Three64 includes a Blender add‑on that lets you attach components to objects and bake a simple navmesh via an in‑Blender UI.

Tested Blender version: 4.3+ (see `src/blender/README.md` for details).

## Install the Blender add‑on
File: `src/blender/three64_blender_addon.py`
1. Open Blender → Edit → Preferences → Add‑ons.
2. Click Install… and select `three64_blender_addon.py`.
3. Enable “Three64 Component Data”.

Preferences (Edit → Preferences → Add‑ons → Three64 Component Data):
- Component Data Directory: defaults to `//component-data` (relative to your .blend).
- For this repo, point it at `src/assets/default-component-data` (generated by the build). Click “Reload Three64 Components” after changing JSONs or the folder.

Important: Build the app locally first so the component presets exist:
```bash
npm run build
# or: npm run dev
```

## Add components to objects (Object Properties)
1. Select an object.
2. Go to Object Properties → “Three64 Component” panel.
3. Choose a component from the dropdown.
4. Click “Add Selected Component”.
   - The object will show the component’s options as editable custom properties.
5. Optional: The same controls appear in the default “Custom Properties” section for quick editing.
6. Colors: When a parameter is a color, you’ll see a color picker and a hex field together.

Tip: You can edit any property value directly in Blender’s Custom Properties. Export with “Include → Custom Properties” enabled in glTF settings.

## Generating a Nav Mesh
Sidebar: Viewport → press N → NavMesh tab → “Three64 NavMesh”
1. Mark objects as navigable:
   - Select a mesh → “Mark Navigable” (sets a boolean custom property; default key `navigable`).
2. Configure bake:
   - Filter Property: which custom property marks walkable objects (default `navigable`)
   - Max Slope (deg): limit walkable surfaces by slope
   - Convert to Three.js (Y‑up): converts Blender coords to Three.js coords
   - Apply Modifiers: bake evaluated geometry
   - Export Path: where to save JSON (default `//navmesh.json`)
3. Bake & Export:
   - Click “Bake & Export NavMesh (JSON)”
   - Optional: “Visualize NavMesh (JSON)” to bring it back into Blender for inspection

At runtime, point the `NavMesh` component’s `url` to your JSON path and enable `useNavMesh` on Agents.

## Exporting GLTF/GLB
Three64 prefers `.glb`:
- File → Export → glTF 2.0 (.glb)
- Recommended:
  - Include only needed collections
  - Apply transforms where appropriate
- Save into `src/assets/models/`. The dev build copies the entire folder; production build tree‑shakes and optimizes models during copy (Draco if available).

## Using the NavMesh at Runtime (where to set values)
1. Export/bake the navmesh JSON to a path served by your site (e.g., `public/build/assets/component-data/navmesh.json`).
2. In Object Properties → “Three64 Component”, add the `NavMesh` component to an empty or any object.
3. Set its `url` option to your JSON path (e.g., `assets/component-data/navmesh.json`).
4. For agents, add or configure the `Agent` component and set `useNavMesh: true` (optionally `repathInterval`).

## Double‑Sided Rendering
- Preferred (per material): In Blender Material → Settings, turn OFF “Backface Culling”. The exporter writes `doubleSided=true` to glTF.
- Add-on per-object override: “Mark Double-Sided” sets `doubleSided = True` on the object (exported via extras). The runtime forces double-sided materials for meshes under that object.
- Precedence:
  - Material `doubleSided` is respected.
  - Object `doubleSided = True` forces double-sided on its meshes.
  - Global default remains single‑sided for performance unless overridden.


